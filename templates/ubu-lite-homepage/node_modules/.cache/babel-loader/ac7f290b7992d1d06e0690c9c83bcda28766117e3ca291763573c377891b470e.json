{"ast":null,"code":"import React,{useEffect,useRef,useState}from'react';import{setToken,setUser}from'../auth';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export const GoogleSignIn=_ref=>{let{role,onSuccessRedirect='/studio',text='continue_with'}=_ref;const btnRef=useRef(null);const[clientId,setClientId]=useState(null);const[error,setError]=useState(null);useEffect(()=>{async function ensureScript(){// fetch client id from backend\ntry{const r=await fetch('/api/auth/google/client-id/');const j=await r.json();if(!j.client_id){setError('Google client ID not configured');return;}setClientId(j.client_id);}catch(_unused){setError('Failed to load Google config');return;}if(document.getElementById('gsi-script'))return;const s=document.createElement('script');s.id='gsi-script';s.src='https://accounts.google.com/gsi/client';s.async=true;s.defer=true;document.head.appendChild(s);}ensureScript();},[]);useEffect(()=>{if(!clientId)return;function init(){if(!window.google||!btnRef.current)return;window.google.accounts.id.initialize({client_id:clientId,callback:async resp=>{if(!(resp!==null&&resp!==void 0&&resp.credential))return;try{const r2=await fetch('/api/auth/google/',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({credential:resp.credential,role})});const j2=await r2.json();if(!r2.ok||!j2.access)throw new Error(j2.detail||'Google login failed');setToken(j2.access);if(j2.user)setUser(j2.user);window.location.href=onSuccessRedirect;}catch(e){setError(e.message||'Google login failed');}}});window.google.accounts.id.renderButton(btnRef.current,{theme:'outline',size:'large',text,shape:'pill'});}const t=setInterval(()=>{if(window.google){clearInterval(t);init();}},100);return()=>clearInterval(t);},[clientId,role,onSuccessRedirect,text]);return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{ref:btnRef}),error&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-2 text-xs text-red-600\",children:error})]});};export default GoogleSignIn;","map":{"version":3,"names":["React","useEffect","useRef","useState","setToken","setUser","jsx","_jsx","jsxs","_jsxs","GoogleSignIn","_ref","role","onSuccessRedirect","text","btnRef","clientId","setClientId","error","setError","ensureScript","r","fetch","j","json","client_id","_unused","document","getElementById","s","createElement","id","src","async","defer","head","appendChild","init","window","google","current","accounts","initialize","callback","resp","credential","r2","method","headers","body","JSON","stringify","j2","ok","access","Error","detail","user","location","href","e","message","renderButton","theme","size","shape","t","setInterval","clearInterval","children","ref","className"],"sources":["C:/Users/Kojos/OneDrive/Desktop/Ubu-Lite/templates/ubu-lite-homepage/src/components/GoogleSignIn.tsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport { setToken, setUser } from '../auth';\n\ndeclare global {\n  interface Window {\n    google?: any;\n  }\n}\n\ntype Props = {\n  role?: 'creative' | 'client';\n  onSuccessRedirect?: string;\n  text?: 'signin_with' | 'signup_with' | 'continue_with' | 'sign_in_with';\n};\n\nexport const GoogleSignIn: React.FC<Props> = ({ role, onSuccessRedirect = '/studio', text = 'continue_with' }) => {\n  const btnRef = useRef<HTMLDivElement>(null);\n  const [clientId, setClientId] = useState<string | null>(null);\n  const [error, setError] = useState<string | null>(null);\n\n  useEffect(() => {\n    async function ensureScript() {\n      // fetch client id from backend\n      try {\n        const r = await fetch('/api/auth/google/client-id/');\n        const j = await r.json();\n        if (!j.client_id) {\n          setError('Google client ID not configured');\n          return;\n        }\n        setClientId(j.client_id);\n      } catch {\n        setError('Failed to load Google config');\n        return;\n      }\n\n      if (document.getElementById('gsi-script')) return;\n      const s = document.createElement('script');\n      s.id = 'gsi-script';\n      s.src = 'https://accounts.google.com/gsi/client';\n      s.async = true;\n      s.defer = true;\n      document.head.appendChild(s);\n    }\n    ensureScript();\n  }, []);\n\n  useEffect(() => {\n    if (!clientId) return;\n    function init() {\n      if (!window.google || !btnRef.current) return;\n      window.google.accounts.id.initialize({\n        client_id: clientId,\n        callback: async (resp: any) => {\n          if (!resp?.credential) return;\n          try {\n            const r2 = await fetch('/api/auth/google/', {\n              method: 'POST',\n              headers: { 'Content-Type': 'application/json' },\n              body: JSON.stringify({ credential: resp.credential, role }),\n            });\n            const j2 = await r2.json();\n            if (!r2.ok || !j2.access) throw new Error(j2.detail || 'Google login failed');\n            setToken(j2.access);\n            if (j2.user) setUser(j2.user);\n            window.location.href = onSuccessRedirect;\n          } catch (e: any) {\n            setError(e.message || 'Google login failed');\n          }\n        },\n      });\n      window.google.accounts.id.renderButton(btnRef.current, {\n        theme: 'outline',\n        size: 'large',\n        text,\n        shape: 'pill',\n      });\n    }\n    const t = setInterval(() => {\n      if (window.google) {\n        clearInterval(t);\n        init();\n      }\n    }, 100);\n    return () => clearInterval(t);\n  }, [clientId, role, onSuccessRedirect, text]);\n\n  return (\n    <div>\n      <div ref={btnRef} />\n      {error && <div className=\"mt-2 text-xs text-red-600\">{error}</div>}\n    </div>\n  );\n};\n\nexport default GoogleSignIn;\n\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}